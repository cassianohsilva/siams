%lex
%%

\n						return '\n';
\s+						;
"add"					return 'R';
"addu"                  return 'R';
"xor"                   return 'R';
"sub"					return 'R';
"subu"					return 'R';
"and"					return 'R';
"xor"					return 'R';
"or"					return 'R';
"nor"					return 'R';
"slt"					return 'R';
"sltu"					return 'R';
"sll"					return 'SR';
"srl"					return 'SR';
"j"                     return 'J';
"jal"                   return 'J';
"jr"					return 'JR';
"beq"                   return 'IL';
"bne"                   return 'IL';
"addi"					return 'IE';
"addiu"					return 'IE';
"slti"                  return 'IE';
"xori"					return 'IE';
"sltiu"                 return 'IE';
"andi"                  return 'IJ';
"ori"                   return 'IJ';
"lw"					return 'IC';
"sw"					return 'IC';
"sb"                    return 'IC';
"lb"                    return 'IC';
"lbu"                   return 'IC';
"lh"                    return 'IC';
"lhu"                   return 'IC';
"sh"                    return 'IC';
"lui"                   return 'IU';
[0-9]+					return 'NUMBER';
<<EOF>>					return 'EOF';
","						return ',';
"$t"[0-9]				return 'REGISTER';
"$zero"					return 'REGISTER';
"$s"[0-7]				return 'REGISTER';
"$v"[0-1]				return 'REGISTER';
"$a"[0-3]				return 'REGISTER';
"$gp"					return 'REGISTER';
"$sp"					return 'REGISTER';
"$fp"					return 'REGISTER';
"$ra"					return 'REGISTER';
\w+						return 'LABEL';
"("						return '(';
")" 					return ')';
"/"                     return '/';
":"						return ':';

/lex

%start 					LINE
%%

LINE			:		INST1 '\n' LINE
							{
							$$ = $1;
							}
				
				|		INST1 EOF
							{
							 $$ = $1;
							 return true;}
				;
				
INST1			:		LABEL ':' INST
							{memoria.saveLabel($1, regs.pc.valor);
							$$ = $3;}

				|		INST
							{$$ = $1;}
				
				;

INST			:		IE REGISTER ',' REGISTER ',' NUMBER
							{var temp = instrucao.getOp($1);			//valor do op
							var temp = temp << 26;
							binario |= temp;
							temp = regs.getNumero($4);					//valor do rs
							temp = temp << 21;
							binario |= temp;
							temp = regs.getNumero($2);					//valor do rs
							temp = temp << 16;
							binario |= temp;
							binario |= $6;
							$$ = binario;
							memoria.setConteudo(yylineno, $$);
							}
				|		IC REGISTER ',' NUMBER '('REGISTER')' 
						   {var temp = instrucao.getOp($1);             //valor do op
							var binario = 0;
							binario = temp << 26;
						    binario |= temp;
							temp = regs.getNumero($6);             // valor do rs
							temp = temp << 21;
							binario |= temp;
							temp = regs.getNumero($2);             //valor do rt
							temp = temp << 16;
							binario |= temp;           
							binario |= $4;                              // valor do end.
							$$ = binario ;
							memoria.setConteudo(yylineno, $$);
							}
				|		R REGISTER ',' REGISTER ',' REGISTER 
							{var temp = instrucao.getOp($1);			//valor do op
							var binario = 0;
							binario = temp << 26;
							temp = regs.getNumero($4);					//valor do rs
							temp = temp << 21;
							binario |= temp;
							temp = regs.getNumero($6);					//valor do rt
							temp = temp << 16;
							binario |= temp;
							temp = regs.getNumero($2);					//valor do rd
							temp = temp << 11;
							binario |= temp;
							temp = 0;									//valor do shamt
							temp = temp << 6;
							binario |= temp;
							binario |= instrucao.getFunct($1);			//valor do funct
							$$ = binario;
							memoria.setConteudo(yylineno, $$);
							}
				|		JR REGISTER   
							{
							 var temp = instrucao.getOp($1);
							 var binario = 0 ;
							 binario= temp << 26;
							 temp = regs.getNumero($2);
							 temp = temp << 21;
							 binario |= temp;
							 temp = 0;
							 temp = temp << 16;
							 binario |= temp;
							 temp = 0;
							 temp = temp << 11;
							 binario  |= temp;
							 temp = 0;
							 temp = temp << 6;
							 binario  |= temp;
							 binario |= instrucao.getFunct($1);
							 $$ = binario;
							 memoria.setConteudo(yylineno, $$);
							}
				|
				        J  NUMBER 
						    {
		                     var temp = instrucao.getOp($1);
                             var binario = 0;
                             binario = temp << 26;
							 binario |= $2;
                             $$ = binario;
                             memoria.setConteudo(yylineno, $$);
       						}
				|
				        IL REGISTER ',' REGISTER ',' NUMBER 
						    {
	                         var temp = instrucao.getOp($1);
                             var binario = 0;
                             binario = temp << 26;
                             temp = regs.getNumero($2);
                             temp = temp << 21;
                             binario |= temp;
                             temp = regs.getNumero($4);
                             temp = temp << 16;
                             binario |= temp;
                             temp = temp  >> 2;       // divide por quatro
                             binario |= temp;							 
                             $$ = binario;
                             memoria.setConteudo(yylineno, $$);	 
							}
				|		SR REGISTER ',' REGISTER ',' NUMBER 
 							{
							var temp = instrucao.getOp($1);
							var binario =0;
							binaro = temp << 26;
							temp = 0;
							temp = temp << 21;
							binario |= temp;
							temp = regs.getNumero($4);
							temp = temp << 16;
							binario |= temp;
							temp = regs.getNumero($2);
							temp = temp << 11;
							binario |= temp;
							temp = regs.getShamt($1);
							temp = temp << 6;
							binario |= temp;
							$$ = binario;
							memoria.setConteudo(yylineno, $$);
							}
				|
                        IU REGISTER ',' NUMBER 
                            {
							 var temp = instrucao.getOp($1);
							 var binario  = 0;
							 binario = temp << 26;
							 temp = 0;
							 temp = temp << 21;
							 binario |= temp;
							 temp = regs.getNumero($2);
							 temp = temp << 16;
							 binario |= temp;
							 binario |= $4;
							 $$ = binario;
							 memoria.setConteudo(yylineno, $$);
							 }
                |       IJ REGISTER ',' REGISTER ',' NUMBER
                           {var temp = instrucao.getOp($1);
						    var binario = 0;
							binario = temp << 26;
							temp = regs.getNumero($4);
						    temp = temp << 21;
							binario |= temp;
							temp = regs.getNumero($2);
							temp = temp << 16;
							binario |= temp;
							binario |= $6;
						    $$ = binario;
						    memoria.setConteudo(yylineno, $$);
						   }				
				;		